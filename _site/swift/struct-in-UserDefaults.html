<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Storing Struct in UserDefaults</title>
    <meta name="description" content="There is a post by Paul Hudson where he explains how structs can be stored in UserDefaults.He recommends converting the value to Data type first and then sto...">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://localhost:4000/swift/struct-in-UserDefaults.html">
    <link rel="alternate" type="application/rss+xml" title="Ashwani" href="http://localhost:4000/feed.xml">
  </head>

  <body>
	<div class="go-home">
	  <a href="http://localhost:4000"> <svg width="100%" height="100%" viewBox="0 0 503 503" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;fill:#f48024"><circle cx="251.115" cy="251.115" r="251.115" class="home"/><clipPath id="_clip1"><circle cx="251.115" cy="251.115" r="251.115"/></clipPath><g clip-path="url(#_clip1)"><path d="M339.941,225.331c0,-2.173 -1.002,-4.225 -2.715,-5.561c-12.744,-9.938 -66.661,-51.986 -82.5,-64.339c-2.575,-2.008 -6.192,-1.985 -8.742,0.054c-15.527,12.421 -67.959,54.362 -80.364,64.285c-1.673,1.339 -2.647,3.365 -2.647,5.507c0,16.884 0,92.029 0,115.535c0,1.871 0.743,3.664 2.065,4.987c1.323,1.322 3.116,2.065 4.987,2.065c11.803,0 35.425,0 47.23,0c1.871,0 3.665,-0.743 4.988,-2.066c1.322,-1.323 2.065,-3.117 2.065,-4.988c-0.007,-19.216 -0.025,-71.055 -0.025,-71.055l54.696,-0.225c0,0 0.11,52.056 0.151,71.297c0.008,3.889 3.163,7.037 7.052,7.037c11.695,0 35.002,0 46.707,0c1.87,0 3.664,-0.743 4.987,-2.065c1.322,-1.323 2.065,-3.116 2.065,-4.987c0,-23.481 0,-98.492 0,-115.481Z" style="fill:#fff;fill-opacity:0.941177;"/></g></svg> </a>
	</div>
    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Storing Struct in UserDefaults</h1>
    <p class="post-meta"><time datetime="2020-03-18T00:00:00+05:30" itemprop="datePublished">Mar 18, 2020</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>There is a <a href="https://www.hackingwithswift.com/example-code/system/how-to-load-and-save-a-struct-in-userdefaults-using-codable">post</a> by Paul Hudson where he explains how structs can be stored in UserDefaults.
He recommends converting the value to <code class="highlighter-rouge">Data</code> type first and then store it directly in UserDefaults.</p>

<p>Similarly for retreving, get the <code class="highlighter-rouge">Data</code> and decode it to get the desired type back</p>

<p>So to make it more convenient and <a href="https://www.swiftbysundell.com/articles/what-makes-code-swifty/">Swifty</a>, I have written the following extension</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">UserDefaults</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="k">let</span> <span class="nv">encoder</span> <span class="o">=</span> <span class="kt">JSONEncoder</span><span class="p">()</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="k">let</span> <span class="nv">decoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>

    <span class="kd">func</span> <span class="n">encodeAndSet</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="n">forKey</span> <span class="n">defaultName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">where</span> <span class="kt">T</span><span class="p">:</span> <span class="kt">Encodable</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">encoded</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="k">Self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">set</span><span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="n">defaultName</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">open</span> <span class="kd">func</span> <span class="n">decodedObject</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">forKey</span> <span class="n">defaultName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">T</span><span class="p">?</span> <span class="k">where</span> <span class="kt">T</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="nf">data</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="n">defaultName</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">try</span><span class="p">?</span> <span class="k">Self</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>After adding above methods to UserDefaults one can easily store Codable types in UserDefaults with just one line of code</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">john</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"John"</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="mi">41</span><span class="p">)</span>
<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">encodeAndSet</span><span class="p">(</span><span class="n">john</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"user"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">getJohn</span><span class="p">:</span> <span class="kt">Person</span><span class="p">?</span> <span class="o">=</span> <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">decodedObject</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"user"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">getJohn</span><span class="p">)</span> <span class="c1">// print Optional(FR.Person(name: "John", age: 41))</span></code></pre></figure>


  </div>

  <div class="post-footer">
    <p><a href="/blog" >Back to Index</a></p>
  </div>
</article>

      </div>
    </div>
  </body>

</html>
